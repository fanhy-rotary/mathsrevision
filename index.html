<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 適性學習測驗</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 自定義樣式 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #f7fafc; /* Tailwind gray-100 */
        }
        
        /* 自定義按鈕基礎樣式 */
        .primary-btn {
            transition: all 0.2s ease-in-out;
        }
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* 主題選擇按鈕樣式 */
        .topic-btn {
            @apply w-full p-6 text-left bg-white rounded-lg shadow-md border border-gray-200 transition-all duration-200 ease-in-out;
        }
        .topic-btn:hover {
            @apply transform -translate-y-1 shadow-lg border-blue-500;
        }

        /* 選項按鈕樣式 */
        .option-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            background-color: #ffffff; /* white */
            text-align: left;
            font-weight: 500;
            color: #2d3748; /* gray-800 */
            transition: all 0.2s ease;
        }
        .option-btn:hover {
            border-color: #4299e1; /* blue-500 */
            background-color: #ebf8ff; /* blue-50 */
        }
        .option-btn:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }

        /* 答對的樣式 */
        .option-btn.correct {
            border-color: #38a169; /* green-600 */
            background-color: #f0fff4; /* green-50 */
            color: #276749; /* green-800 */
            font-weight: 700;
        }
        /* 答錯的樣式 */
        .option-btn.wrong {
            border-color: #e53e3e; /* red-600 */
            background-color: #fff5f5; /* red-50 */
            color: #c53030; /* red-800 */
            font-weight: 700;
        }

        /* 次要按鈕 (例如返回) */
        .secondary-btn {
            @apply w-full mt-4 text-center text-gray-600 font-medium py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors duration-200;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-100 p-4 pb-16"> <!-- 增加底部 padding -->

    <div class="w-full max-w-2xl mx-auto">
        
        <!-- 頂部標題和難度顯示 -->
        <header class="mb-6 text-center">
            <h1 id="app-title" class="text-3xl font-bold text-gray-800">數學適性學習</h1>
            <p id="app-subtitle" class="text-lg text-gray-600">請選擇一個練習主題</p>
            <div id="difficulty-display" class="mt-4 inline-block bg-blue-100 text-blue-800 text-sm font-semibold px-4 py-2 rounded-full hidden">
                目前難度：初級
            </div>
        </header>

        <!-- 主內容區域 -->
        <main id="app-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">

            <!-- 0. 主題選擇畫面 (新加入，預設顯示) -->
            <div id="topic-screen">
                <h2 class="text-2xl font-semibold text-gray-700 mb-6 text-center">選擇練習主題</h2>
                <div class="space-y-4">
                    <button id="select-topic-indices" data-topic="指數" class="topic-btn group">
                        <h3 class="text-xl font-bold text-blue-700 group-hover:text-blue-600">指數 (Indices)</h3>
                        <p class="text-gray-600 mt-1">練習指數定律，包括正負指數、分數指數和化簡。</p>
                    </button>
                    <button id="select-topic-factorization" data-topic="因式分解" class="topic-btn group">
                        <h3 class="text-xl font-bold text-green-700 group-hover:text-green-600">因式分解 (Factorization)</h3>
                        <p class="text-gray-600 mt-1">練習提取公因式、十字相乘、恆等式和分組法。</p>
                    </button>
                </div>
            </div>

            <!-- 1. 開始畫面 (預設隱藏) -->
            <div id="start-screen" class="hidden">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">準備好開始了嗎？</h2>
                <p class="text-gray-600 mb-6">點擊按鈕，系統將根據您目前的難度「<span id="start-difficulty-label" class="font-bold">初級</span>」，隨機抽取 5 道題目。</p>
                <button id="start-button" class="w-full primary-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                    開始測驗
                </button>
                <button id="back-to-topic-select" class="secondary-btn">
                    返回主題選擇
                </button>
            </div>

            <!-- 2. 測驗畫面 (預設隱藏) -->
            <div id="quiz-screen" class="hidden">
                <!-- 題目進度 -->
                <div class="mb-4 flex justify-between items-center">
                    <span id="question-counter" class="text-sm font-medium text-gray-600">題目 1 / 5</span>
                    <span id="current-score" class="text-sm font-medium text-blue-600">目前得分：0</span>
                </div>
                
                <!-- 題目內容 -->
                <div class="mb-6">
                    <p id="question-text" class="text-xl font-semibold text-gray-800 leading-relaxed" style="min-height: 4rem;">
                        <!-- 題目將由 JS 動態生成 (使用 innerHTML) -->
                    </p>
                </div>

                <!-- 選項容器 -->
                <div id="options-container" class="space-y-3">
                    <!-- 選項將由 JS 動態生成 (使用 innerHTML) -->
                </div>

                <!-- 對/錯 反饋 -->
                <div id="answer-status" class="hidden mt-6 text-xl font-bold">
                    <!-- JS 將會設定文字和顏色 -->
                </div>

                <!-- 正確答案反饋 -->
                <div id="feedback-container" class="hidden mt-2 p-4 rounded-lg bg-green-50 border border-green-200">
                    <p class="font-semibold text-green-800">正確答案：</p>
                    <p id="correct-answer-text" class="text-green-700"></p>
                </div>

                <!-- 下一題按鈕 (預設隱藏) -->
                <button id="next-button" class="w-full mt-8 primary-btn bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 hidden">
                    下一題
                </button>
                
                <button id="quiz-change-topic-btn" class="secondary-btn">
                    放棄本輪並返回主題選擇
                </button>
            </div>

            <!-- 3. 總結畫面 (預設隱藏) -->
            <div id="summary-screen" class="hidden text-center">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">本輪總結</h2>
                <p id="summary-text" class="text-lg text-gray-600 mb-6">您在 5 題中答對了 0 題。</p>
                <div id="assessment-feedback" class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p id="assessment-text" class="text-yellow-800 font-medium"></p>
                </div>
                <button id="next-session-button" class="w-full primary-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                    開始下一輪
                </button>
                <button id="summary-change-topic-btn" class="secondary-btn">
                    返回主題選擇
                </button>
            </div>

        </main>
    </div>

    <!-- Credit Footer -->
    <footer class="fixed bottom-4 right-6 text-sm text-gray-500">
        Created by Mr. Fan Ho Yin
    </footer>

    <script>
        // --- 靜態題庫 ---

        // 題庫 1: 指數
        const indicesQuestionBank = {
            '初級': [
                // 1-10
                { question: "化簡 (a<sup>3</sup>b<sup>-2</sup>)<sup>-1</sup>", options: ["a<sup>3</sup>b<sup>2</sup>", "1 / (a<sup>3</sup>b<sup>2</sup>)", "b<sup>2</sup> / a<sup>3</sup>", "a<sup>-3</sup>b<sup>2</sup>"], correctAnswerIndex: 2 },
                { question: "化簡 (x<sup>-5</sup>y<sup>2</sup>)<sup>2</sup>", options: ["y<sup>4</sup> / x<sup>10</sup>", "x<sup>10</sup>y<sup>4</sup>", "x<sup>-10</sup>y<sup>4</sup>", "y<sup>4</sup> / x<sup>7</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (p<sup>-1</sup>q<sup>3</sup>)<sup>-2</sup>", options: ["p<sup>2</sup> / q<sup>6</sup>", "q<sup>6</sup> / p<sup>2</sup>", "p<sup>-2</sup>q<sup>-6</sup>", "p<sup>2</sup>q<sup>-6</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (m<sup>4</sup>n<sup>-1</sup>) / (m<sup>-1</sup>)", options: ["m<sup>3</sup> / n", "m<sup>5</sup> / n", "m<sup>3</sup>n", "m<sup>5</sup>n"], correctAnswerIndex: 1 },
                { question: "化簡 (a<sup>2</sup>b<sup>3</sup>)(a<sup>-3</sup>b<sup>-1</sup>)", options: ["b<sup>2</sup> / a", "a / b<sup>2</sup>", "ab<sup>2</sup>", "a<sup>-1</sup>b<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>0</sup>y<sup>-2</sup>)<sup>-3</sup> (x 不等於 0)", options: ["y<sup>6</sup>", "1 / y<sup>6</sup>", "y<sup>-6</sup>", "x<sup>-3</sup>y<sup>6</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (k<sup>5</sup>) / (k<sup>-2</sup>k<sup>3</sup>)", options: ["k<sup>4</sup>", "k<sup>6</sup>", "k<sup>10</sup>", "1 / k<sup>4</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>-2</sup>b<sup>4</sup>c<sup>-1</sup>)<sup>2</sup>", options: ["b<sup>8</sup> / (a<sup>4</sup>c<sup>2</sup>)", "a<sup>4</sup>b<sup>8</sup>c<sup>2</sup>", "b<sup>6</sup> / (a<sup>4</sup>c)", "b<sup>8</sup> / (a<sup>4</sup>c)"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>2</sup>y<sup>-3</sup>) / (x<sup>-1</sup>y<sup>-5</sup>)", options: ["x<sup>3</sup>y<sup>2</sup>", "x / y<sup>2</sup>", "x<sup>3</sup> / y<sup>8</sup>", "x<sup>3</sup> / y<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (2a<sup>-1</sup>b<sup>2</sup>)<sup>3</sup>", options: ["8b<sup>6</sup> / a<sup>3</sup>", "6b<sup>6</sup> / a<sup>3</sup>", "8a<sup>-3</sup>b<sup>6</sup>", "2b<sup>6</sup> / a<sup>3</sup>"], correctAnswerIndex: 0 },
                // 11-20
                { question: "化簡 (x<sup>-1</sup> + y<sup>-1</sup>) / (x<sup>-1</sup>)", options: ["y", "1 + x/y", "1 + y/x", "(x+y)/y"], correctAnswerIndex: 2 },
                { question: "化簡 (a<sup>4</sup>b<sup>-2</sup>c<sup>0</sup>)<sup>-2</sup>", options: ["b<sup>4</sup> / a<sup>8</sup>", "a<sup>8</sup> / b<sup>4</sup>", "b<sup>-4</sup> / a<sup>-8</sup>", "b<sup>4</sup> / (a<sup>8</sup>c<sup>2</sup>)"], correctAnswerIndex: 0 },
                { question: "化簡 (m<sup>-4</sup>) / (m<sup>-5</sup>)", options: ["1/m", "m<sup>9</sup>", "m", "1/m<sup>9</sup>"], correctAnswerIndex: 2 },
                { question: "化簡 (p<sup>2</sup>q<sup>-3</sup>)<sup>-2</sup> (p<sup>-1</sup>q<sup>2</sup>)", options: ["q<sup>8</sup> / p<sup>5</sup>", "q<sup>4</sup> / p<sup>5</sup>", "p<sup>5</sup> / q<sup>8</sup>", "p<sup>-5</sup>q<sup>8</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>5</sup>b<sup>-3</sup>) / (a<sup>-2</sup>b<sup>-1</sup>)", options: ["a<sup>7</sup>b<sup>2</sup>", "a<sup>3</sup> / b<sup>2</sup>", "a<sup>7</sup> / b<sup>2</sup>", "a<sup>7</sup> / b<sup>4</sup>"], correctAnswerIndex: 2 },
                { question: "化簡 (3x<sup>-2</sup>y)<sup>-1</sup>", options: ["x<sup>2</sup> / (3y)", "3x<sup>2</sup>y", "1 / (3x<sup>-2</sup>y)", "x<sup>2</sup>y / 3"], correctAnswerIndex: 0 },
                { question: "化簡 (c<sup>-3</sup>d<sup>-4</sup>)<sup>-2</sup>", options: ["c<sup>6</sup>d<sup>8</sup>", "1 / (c<sup>6</sup>d<sup>8</sup>)", "c<sup>-6</sup>d<sup>-8</sup>", "c<sup>5</sup>d<sup>6</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (h<sup>-3</sup>k<sup>0</sup>) / (h<sup>-5</sup>k<sup>-1</sup>)", options: ["h<sup>2</sup> / k", "h<sup>2</sup>k", "k / h<sup>2</sup>", "h<sup>8</sup>k"], correctAnswerIndex: 1 },
                { question: "化簡 (x<sup>1/2</sup>y<sup>-1</sup>)<sup>2</sup>", options: ["x / y<sup>2</sup>", "xy<sup>2</sup>", "x<sup>1/4</sup> / y", "x / y"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>-1</sup>b<sup>2</sup>c<sup>-3</sup>) / (a<sup>-2</sup>b<sup>-1</sup>c)", options: ["ab<sup>3</sup> / c<sup>4</sup>", "b / (ac<sup>2</sup>)", "ab<sup>3</sup> / c<sup>2</sup>", "ab / c<sup>4</sup>"], correctAnswerIndex: 0 },
                // 21-25
                { question: "化簡 (m<sup>-1</sup>n<sup>2</sup>)<sup>3</sup> (m<sup>4</sup>n<sup>-1</sup>)", options: ["mn<sup>5</sup>", "n<sup>5</sup> / m", "m<sup>7</sup>n<sup>5</sup>", "n<sup>5</sup> / m<sup>3</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (p<sup>-3</sup>q<sup>-2</sup>) / (p<sup>-1</sup>q<sup>-3</sup>)", options: ["q / p<sup>2</sup>", "p<sup>2</sup> / q", "q / p<sup>4</sup>", "p<sup>4</sup> / q"], correctAnswerIndex: 0 },
                { question: "化簡 (4a<sup>-2</sup>)<sup>1/2</sup>", options: ["2 / a", "2a", "2 / a<sup>2</sup>", "4 / a"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>-2</sup>b<sup>3</sup>)<sup>-2</sup>", options: ["a<sup>4</sup> / b<sup>6</sup>", "b<sup>6</sup> / a<sup>4</sup>", "a<sup>-4</sup>b<sup>-6</sup>", "a<sup>4</sup> / b<sup>5</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-2</sup>y<sup>3</sup>z) / (x<sup>-3</sup>y<sup>-1</sup>z<sup>0</sup>)", options: ["xy<sup>4</sup>z", "y<sup>4</sup>z / x", "xy<sup>4</sup>", "xy<sup>2</sup>z"], correctAnswerIndex: 0 },
            ],
            '中級': [
                // 1-10
                { question: "化簡 (a<sup>-2</sup>b<sup>3</sup>)<sup>3</sup> / (a<sup>-3</sup>b<sup>5</sup>)", options: ["b<sup>4</sup> / a<sup>3</sup>", "a<sup>3</sup> / b<sup>4</sup>", "a<sup>-3</sup>b<sup>4</sup>", "b<sup>4</sup> / a<sup>9</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-1</sup>y<sup>4</sup>)<sup>-2</sup> (x<sup>3</sup>y<sup>-2</sup>)", options: ["x / y<sup>10</sup>", "x<sup>5</sup> / y<sup>10</sup>", "y<sup>10</sup> / x<sup>5</sup>", "x<sup>5</sup> / y<sup>6</sup>"], correctAnswerIndex: 1 },
                { question: "化簡 ( (m<sup>-2</sup>n<sup>3</sup>)<sup>2</sup> ) / (m<sup>-5</sup>n<sup>-1</sup>)", options: ["mn<sup>7</sup>", "n<sup>7</sup> / m", "m<sup>9</sup>n<sup>7</sup>", "mn<sup>5</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (p<sup>4</sup>q<sup>-1</sup>)<sup>-1</sup> ) / (p<sup>-2</sup>q<sup>3</sup>)", options: ["1 / (p<sup>2</sup>q<sup>2</sup>)", "p<sup>6</sup> / q<sup>2</sup>", "p<sup>2</sup>q<sup>2</sup>", "q<sup>2</sup> / p<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>1/2</sup>b<sup>-1</sup>)<sup>4</sup> (a<sup>-3</sup>)", options: ["b<sup>4</sup> / a", "a / b<sup>4</sup>", "1 / (ab<sup>4</sup>)", "a<sup>-1</sup>b<sup>-4</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-4</sup>y<sup>8</sup>)<sup>1/4</sup>", options: ["y<sup>2</sup> / x", "x / y<sup>2</sup>", "y<sup>2</sup> / x<sup>16</sup>", "y<sup>4</sup> / x"], correctAnswerIndex: 0 },
                { question: "化簡 ( (8a<sup>6</sup>) / (a<sup>-3</sup>) )<sup>1/3</sup>", options: ["2a<sup>3</sup>", "2a<sup>2</sup>", "2a<sup>1</sup>", "8a<sup>3</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-1</sup>y<sup>2</sup>z<sup>-3</sup>)<sup>-2</sup> / (x<sup>2</sup>y<sup>-1</sup>z<sup>7</sup>)", options: ["z / (y<sup>5</sup>)", "y<sup>5</sup> / z", "z<sup>-1</sup>y<sup>-5</sup>", "1 / (y<sup>5</sup>z)"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>-2</sup>b<sup>4</sup>) / (a<sup>4</sup>b<sup>-2</sup>) )<sup>1/2</sup>", options: ["b<sup>3</sup> / a<sup>3</sup>", "b / a", "a<sup>3</sup> / b<sup>3</sup>", "b<sup>3</sup> / a"], correctAnswerIndex: 0 },
                { question: "化簡 (m<sup>3</sup>n<sup>-1</sup>)<sup>-2</sup> (m<sup>-1</sup>n<sup>5</sup>)<sup>-1</sup>", options: ["m<sup>-5</sup>n<sup>-3</sup>", "1 / (m<sup>5</sup>n<sup>3</sup>)", "m<sup>5</sup> / n<sup>3</sup>", "n<sup>3</sup> / m<sup>5</sup>"], correctAnswerIndex: 1 },
                // 11-20
                { question: "化簡 (p<sup>-1/2</sup>q<sup>-2</sup>)<sup>-4</sup>", options: ["p<sup>2</sup>q<sup>8</sup>", "q<sup>8</sup> / p<sup>2</sup>", "p<sup>-2</sup>q<sup>8</sup>", "p<sup>2</sup> / q<sup>8</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>-3</sup>b<sup>2</sup>)<sup>-2</sup> / (a<sup>2</sup>b<sup>-1</sup>)<sup>3</sup>", options: ["ab", "1/ (a<sup>12</sup>b<sup>7</sup>)", "a<sup>12</sup>b<sup>7</sup>", "1 / (b<sup>7</sup>)"], correctAnswerIndex: 2 },
                { question: "化簡 ( (x<sup>-2</sup>y<sup>5</sup>z) / (x<sup>-4</sup>y<sup>-1</sup>z<sup>3</sup>) )<sup>-1</sup>", options: ["z<sup>2</sup> / (x<sup>2</sup>y<sup>6</sup>)", "x<sup>2</sup>y<sup>6</sup> / z<sup>2</sup>", "z<sup>2</sup> / (x<sup>6</sup>y<sup>6</sup>)", "x<sup>2</sup>y<sup>6</sup>z<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>-1</sup>b<sup>-2</sup>c<sup>3</sup>)<sup>-2</sup> ) / (a<sup>4</sup>b<sup>-1</sup>c<sup>-5</sup>)", options: ["b<sup>5</sup> / (a<sup>2</sup>c)", "b<sup>5</sup>c / a<sup>2</sup>", "a<sup>2</sup>c / b<sup>5</sup>", "b<sup>3</sup> / (a<sup>2</sup>c)"], correctAnswerIndex: 0 },
                { question: "化簡 (8m<sup>-3</sup>n<sup>6</sup>)<sup>1/3</sup>", options: ["2n<sup>2</sup> / m", "2m / n<sup>2</sup>", "2n<sup>2</sup> / m<sup>3</sup>", "2n<sup>3</sup> / m"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-2/3</sup>y<sup>-1</sup>)<sup>-3</sup>", options: ["x<sup>2</sup>y<sup>3</sup>", "x<sup>2</sup> / y<sup>3</sup>", "y<sup>3</sup> / x<sup>2</sup>", "1 / (x<sup>2</sup>y<sup>3</sup>)"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>-3</sup>b<sup>4</sup>) / (a<sup>-1</sup>b<sup>-2</sup>) )<sup>-2</sup>", options: ["a<sup>4</sup> / b<sup>12</sup>", "b<sup>12</sup> / a<sup>4</sup>", "a<sup>4</sup> / b<sup>8</sup>", "a<sup>8</sup> / b<sup>12</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (p<sup>1/3</sup>q<sup>-2/3</sup>)<sup>-3</sup> (p<sup>-1</sup>q<sup>3</sup>)", options: ["q / p<sup>2</sup>", "q<sup>5</sup> / p<sup>2</sup>", "p<sup>2</sup>q<sup>5</sup>", "p<sup>2</sup> / q<sup>5</sup>"], correctAnswerIndex: 1 },
                { question: "化簡 ( (4x<sup>-2</sup>) / (9y<sup>4</sup>) )<sup>-1/2</sup>", options: ["3xy<sup>2</sup> / 2", "2xy<sup>2</sup> / 3", "3y<sup>2</sup> / (2x)", "2y<sup>2</sup> / (3x)"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>-1</sup> + b<sup>-1</sup>) / (a<sup>-1</sup> - b<sup>-1</sup>) )", options: ["(a+b)/(a-b)", "(b+a)/(b-a)", "(b-a)/(b+a)", "1"], correctAnswerIndex: 1 },
                // 21-25
                { question: "化簡 ( (k<sup>-2</sup>h<sup>3</sup>)<sup>-1</sup> ) / (k<sup>-1</sup>h<sup>-2</sup>)", options: ["k<sup>3</sup> / h", "k / h<sup>5</sup>", "h / k<sup>3</sup>", "k<sup>3</sup> / h<sup>5</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-4</sup>y<sup>-2</sup>z<sup>0</sup>)<sup>-1/2</sup>", options: ["x<sup>2</sup>y", "xy<sup>2</sup>", "x<sup>2</sup>/y", "y/x<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (a<sup>-2</sup>b<sup>-1</sup>c<sup>3</sup>)<sup>-2</sup> (a<sup>-1</sup>b<sup>-2</sup>c<sup>-1</sup>)", options: ["a<sup>3</sup> / (b<sup>4</sup>c<sup>7</sup>)", "a<sup>3</sup>c<sup>7</sup> / b<sup>4</sup>", "a<sup>5</sup> / c<sup>7</sup>", "a<sup>3</sup> / c<sup>7</sup>"], correctAnswerIndex: 3 },
                { question: "化簡 ( (m<sup>-2</sup>n<sup>3</sup>) / (m<sup>-1</sup>n<sup>-2</sup>) )<sup>-2</sup>", options: ["m<sup>2</sup> / n<sup>10</sup>", "n<sup>10</sup> / m<sup>2</sup>", "m<sup>6</sup> / n<sup>10</sup>", "m<sup>2</sup> / n<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 (p<sup>-1</sup>q<sup>2</sup>r<sup>-3</sup>)<sup>-2</sup>", options: ["p<sup>2</sup>r<sup>6</sup> / q<sup>4</sup>", "q<sup>4</sup>r<sup>6</sup> / p<sup>2</sup>", "p<sup>2</sup>q<sup>4</sup> / r<sup>6</sup>", "p<sup>2</sup> / (q<sup>4</sup>r<sup>6</sup>)"], correctAnswerIndex: 0 },
            ],
            '高級': [
                // 1-10
                { question: "化簡 (m<sup>9</sup>n<sup>-6</sup>)<sup>3</sup> (m<sup>-8</sup>n<sup>4</sup>)<sup>5</sup>", options: ["n<sup>2</sup> / m<sup>13</sup>", "m<sup>13</sup> / n<sup>2</sup>", "m<sup>-13</sup>n<sup>2</sup>", "m<sup>13</sup>n<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (pq<sup>3</sup>)<sup>4</sup> ) / (p<sup>6</sup>)", options: ["q<sup>12</sup> / p<sup>2</sup>", "p<sup>2</sup> / q<sup>12</sup>", "p<sup>10</sup>q<sup>12</sup>", "q<sup>7</sup> / p<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>2</sup>b<sup>-3</sup>)<sup>5</sup> ) / ( (a<sup>-4</sup>)<sup>2</sup> )", options: ["a<sup>18</sup> / b<sup>15</sup>", "b<sup>15</sup> / a<sup>18</sup>", "a<sup>2</sup> / b<sup>15</sup>", "a<sup>18</sup>b<sup>15</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( a<sup>7</sup> ) / ( (a<sup>4</sup>b<sup>-6</sup>)<sup>5</sup> )", options: ["b<sup>30</sup> / a<sup>13</sup>", "a<sup>13</sup> / b<sup>30</sup>", "a<sup>27</sup>b<sup>30</sup>", "b<sup>30</sup> / a<sup>27</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (x<sup>25</sup>y<sup>-30</sup>) / ( (x<sup>6</sup>y<sup>3</sup>)<sup>7</sup> ) )", options: ["y<sup>51</sup> / x<sup>17</sup>", "x<sup>17</sup> / y<sup>51</sup>", "x<sup>17</sup>y<sup>51</sup>", "y<sup>9</sup> / x<sup>17</sup>"], correctAnswerIndex: 1 },
                { question: "化簡 ( (p<sup>3</sup>q<sup>-4</sup>)<sup>6</sup> ) / ( p<sup>-12</sup>q<sup>10</sup> )", options: ["p<sup>30</sup> / q<sup>34</sup>", "q<sup>34</sup> / p<sup>30</sup>", "p<sup>6</sup> / q<sup>34</sup>", "p<sup>30</sup> / q<sup>14</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (pq<sup>-5</sup>)<sup>2</sup> ) / ( p<sup>2</sup>q<sup>-3</sup> )", options: ["1 / q<sup>7</sup>", "q<sup>7</sup>", "q<sup>13</sup> / p<sup>4</sup>", "p<sup>4</sup> / q<sup>13</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>15</sup>b<sup>11</sup>) / ( (a<sup>-2</sup>b<sup>3</sup>)<sup>-2</sup> ) )", options: ["a<sup>11</sup>b<sup>17</sup>", "a<sup>19</sup>b<sup>17</sup>", "a<sup>11</sup>b<sup>5</sup>", "a<sup>11</sup> / b<sup>5</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>6</sup>b<sup>-2</sup>)<sup>3</sup> ) / ( (a<sup>-3</sup>)<sup>4</sup> )", options: ["a<sup>30</sup> / b<sup>6</sup>", "b<sup>6</sup> / a<sup>30</sup>", "a<sup>6</sup> / b<sup>6</sup>", "a<sup>30</sup>b<sup>6</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>2</sup>b<sup>6</sup>) / ( (a<sup>-1</sup>b<sup>4</sup>)<sup>2</sup> ) )", options: ["a<sup>4</sup> / b<sup>2</sup>", "b<sup>2</sup> / a<sup>4</sup>", "a<sup>4</sup>b<sup>2</sup>", "1 / (a<sup>4</sup>b<sup>2</sup>)"], correctAnswerIndex: 0 },
                // 11-20
                { question: "化簡 (ab<sup>2</sup>)(a<sup>-4</sup>b<sup>-1</sup>)<sup>3</sup>", options: ["1 / (a<sup>11</sup>b)", "a<sup>11</sup>b", "a<sup>13</sup>b", "b / a<sup>11</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( ab<sup>9</sup> ) / ( (a<sup>7</sup>b<sup>-2</sup>)<sup>-4</sup> )", options: ["a<sup>29</sup>b", "b / a<sup>29</sup>", "a<sup>27</sup>b", "a<sup>29</sup>b<sup>17</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (4m<sup>-2</sup>n<sup>4</sup>) / (m<sup>-1</sup>n<sup>-2</sup>) )<sup>-2</sup>", options: ["m<sup>2</sup> / (16n<sup>12</sup>)", "16n<sup>12</sup> / m<sup>2</sup>", "m<sup>6</sup> / (16n<sup>12</sup>)", "m<sup>2</sup> / (16n<sup>4</sup>)"], correctAnswerIndex: 0 },
                { question: "化簡 ( (x<sup>-1</sup>y<sup>2</sup>)<sup>3</sup> (x<sup>2</sup>y<sup>-3</sup>)<sup>-1</sup> ) / (x<sup>-5</sup>y<sup>10</sup>)", options: ["1 / y", "y", "1 / (y x<sup>10</sup>)", "x<sup>10</sup> / y"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>-2</sup>b<sup>3</sup>c)<sup>-2</sup> ) / ( (a<sup>3</sup>b<sup>-1</sup>c<sup>-2</sup>)<sup>-1</sup> )", options: ["a / (b<sup>7</sup>c<sup>4</sup>)", "a<sup>7</sup>b<sup>7</sup>c<sup>4</sup>", "a / b<sup>7</sup>", "a / (b<sup>5</sup>c<sup>4</sup>)"], correctAnswerIndex: 2 },
                { question: "化簡 ( (p<sup>-1</sup> + q<sup>-1</sup>) / (p<sup>-2</sup> - q<sup>-2</sup>) )", options: ["pq(q+p) / (q<sup>2</sup>-p<sup>2</sup>)", "pq / (q-p)", "(q-p) / pq", "(q+p) / (q-p)"], correctAnswerIndex: 1 },
                { question: "化簡 ( (16a<sup>-4</sup>b<sup>8</sup>) / (c<sup>-12</sup>) )<sup>-1/4</sup>", options: ["a / (2b<sup>2</sup>c<sup>3</sup>)", "2b<sup>2</sup>c<sup>3</sup> / a", "a / (2b<sup>2</sup>c<sup>-3</sup>)", "a / (16b<sup>2</sup>c<sup>3</sup>)"], correctAnswerIndex: 0 },
                { question: "化簡 (x<sup>-3</sup>y<sup>2</sup>)<sup>-4</sup> (x<sup>-2</sup>y<sup>-5</sup>)<sup>-3</sup>", options: ["x<sup>18</sup>y<sup>7</sup>", "x<sup>18</sup> / y<sup>7</sup>", "y<sup>7</sup> / x<sup>18</sup>", "x<sup>6</sup>y<sup>7</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (m<sup>-2</sup>n<sup>4</sup>)<sup>1/2</sup> ) / ( (m<sup>-3</sup>n<sup>6</sup>)<sup>1/3</sup> )", options: ["n", "m", "1", "1/m"], correctAnswerIndex: 2 },
                { question: "化簡 ( (a<sup>-3</sup>b<sup>2</sup>c<sup>-1</sup>) / (a<sup>-1</sup>b<sup>-3</sup>c<sup>-2</sup>) )<sup>-2</sup>", options: ["a<sup>4</sup> / (b<sup>10</sup>c<sup>2</sup>)", "b<sup>10</sup>c<sup>2</sup> / a<sup>4</sup>", "a<sup>4</sup> / (b<sup>10</sup>c)", "a<sup>4</sup> / (b<sup>2</sup>c<sup>2</sup>)"], correctAnswerIndex: 0 },
                // 21-25
                { question: "化簡 ( (x<sup>-2</sup>y<sup>4</sup>)<sup>-3</sup> ) / ( (x<sup>3</sup>y<sup>-5</sup>)<sup>-2</sup> )", options: ["x<sup>12</sup>y<sup>2</sup>", "1 / (x<sup>12</sup>y<sup>2</sup>)", "y<sup>2</sup> / x<sup>12</sup>", "x<sup>12</sup> / y<sup>2</sup>"], correctAnswerIndex: 3 },
                { question: "化簡 ( (a<sup>-1</sup>b<sup>2</sup>) / (a<sup>-3</sup>b<sup>-1</sup>) )<sup>-1/2</sup>", options: ["1 / (ab<sup>3/2</sup>)", "ab<sup>3/2</sup>", "1 / (a<sup>2</sup>b<sup>3/2</sup>)", "1 / (ab<sup>3</sup>)"], correctAnswerIndex: 0 },
                { question: "化簡 ( (p<sup>-3</sup>q<sup>2</sup>)<sup>2</sup> (p<sup>4</sup>q<sup>-1</sup>)<sup>3</sup> ) / ( (pq)<sup>-1</sup> )", options: ["p<sup>7</sup>q<sup>2</sup>", "p<sup>5</sup>q<sup>2</sup>", "p<sup>7</sup>q", "p<sup>7</sup>"], correctAnswerIndex: 0 },
                { question: "化簡 ( (8x<sup>-3</sup>y<sup>6</sup>)<sup>-1/3</sup> ) / ( (x<sup>2</sup>y<sup>-1</sup>)<sup>-1</sup> )", options: ["1 / (2y)", "y / 2", "x / (2y)", "1 / (2xy)"], correctAnswerIndex: 0 },
                { question: "化簡 ( (a<sup>n-1</sup> b<sup>2n</sup>) / (a<sup>-n</sup> b<sup>n+1</sup>) )<sup>2</sup>", options: ["a<sup>4n-2</sup>b<sup>2n-2</sup>", "a<sup>4n-2</sup>b<sup>2n+2</sup>", "a<sup>2n-2</sup>b<sup>2n-2</sup>", "a<sup>4n+2</sup>b<sup>2n-2</sup>"], correctAnswerIndex: 0 },
            ]
        };

        // 題庫 2: 因式分解 (新)
        const factorizationQuestionBank = {
            '初級': [
                // 1-10 (Common Factor & Difference of Squares)
                { question: "因式分解 3x<sup>2</sup> + 6xy", options: ["3x(x + 2y)", "3x(x + 6y)", "x(3x + 6y)", "3(x<sup>2</sup> + 2xy)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>2</sup> - 16", options: ["(a - 4)<sup>2</sup>", "(a - 4)(a + 4)", "(a - 8)(a + 2)", "(a + 4)<sup>2</sup>"], correctAnswerIndex: 1 },
                { question: "因式分解 5ab<sup>2</sup> - 10a<sup>2</sup>b", options: ["5ab(b - 2a)", "5ab(b - 10a)", "5a(b<sup>2</sup> - 2ab)", "ab(5b - 10a)"], correctAnswerIndex: 0 },
                { question: "因式分解 9p<sup>2</sup> - 1", options: ["(9p - 1)(p + 1)", "(3p - 1)(3p + 1)", "(3p - 1)<sup>2</sup>", "(9p - 1)(9p + 1)"], correctAnswerIndex: 1 },
                { question: "因式分解 x(a + b) + y(a + b)", options: ["(x + y)(a + b)", "(x + a)(y + b)", "xy(a + b)", "(xy)(a + b)<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "因式分解 4m<sup>2</sup> - 25n<sup>2</sup>", options: ["(4m - 25n)(m + n)", "(2m - 5n)<sup>2</sup>", "(2m - 5n)(2m + 5n)", "(2m + 5n)<sup>2</sup>"], correctAnswerIndex: 2 },
                { question: "因式分解 2a<sup>2</sup> + 4ab + 6ac", options: ["2a(a + 2b + 3c)", "2(a<sup>2</sup> + 2ab + 3ac)", "a(2a + 4b + 6c)", "2a(a + 2b + 6c)"], correctAnswerIndex: 0 },
                { question: "因式分解 1 - 64y<sup>2</sup>", options: ["(1 - 32y)(1 + 32y)", "(1 - 8y)<sup>2</sup>", "(1 - 8y)(1 + 8y)", "(1 + 8y)<sup>2</sup>"], correctAnswerIndex: 2 },
                { question: "因式分解 p<sup>2</sup>q - pq<sup>2</sup>", options: ["p(pq - q<sup>2</sup>)", "q(p<sup>2</sup> - pq)", "pq(p - q)", "pq(p + q)"], correctAnswerIndex: 2 },
                { question: "因式分解 (x + y)<sup>2</sup> - 9", options: ["(x + y - 3)(x + y + 3)", "(x + y - 3)<sup>2</sup>", "(x + y - 9)(x + y + 9)", "(x + y - 1)(x + y + 9)"], correctAnswerIndex: 0 },
                // 11-20 (Perfect Squares & Simple Grouping)
                { question: "因式分解 x<sup>2</sup> + 6x + 9", options: ["(x + 3)<sup>2</sup>", "(x + 3)(x - 3)", "(x + 6)(x + 3)", "(x + 9)(x + 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>2</sup> - 10a + 25", options: ["(a - 5)(a + 5)", "(a - 10)(a - 15)", "(a - 5)<sup>2</sup>", "(a + 5)<sup>2</sup>"], correctAnswerIndex: 2 },
                { question: "因式分解 4y<sup>2</sup> + 4y + 1", options: ["(4y + 1)<sup>2</sup>", "(2y + 1)(2y - 1)", "(2y + 1)<sup>2</sup>", "(2y - 1)<sup>2</sup>"], correctAnswerIndex: 2 },
                { question: "因式分解 9k<sup>2</sup> - 12k + 4", options: ["(3k - 2)<sup>2</sup>", "(3k + 2)<sup>2</sup>", "(3k - 2)(3k + 2)", "(9k - 4)(k - 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 ax + ay + bx + by", options: ["(a + b)(x + y)", "(a + x)(b + y)", "ab(x + y)", "xy(a + b)"], correctAnswerIndex: 0 },
                { question: "因式分解 pm - pn - qm + qn", options: ["(p - q)(m - n)", "(p + q)(m - n)", "(p - q)(m + n)", "(p + q)(m + n)"], correctAnswerIndex: 0 },
                { question: "因式分解 x<sup>2</sup> + 2xy + y<sup>2</sup>", options: ["(x + y)<sup>2</sup>", "(x - y)<sup>2</sup>", "(x + y)(x - y)", "x(x + 2y) + y<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "因式分解 m<sup>2</sup> - 16m + 64", options: ["(m + 8)<sup>2</sup>", "(m - 8)(m + 8)", "(m - 64)(m - 1)", "(m - 8)<sup>2</sup>"], correctAnswerIndex: 3 },
                { question: "因式分解 2x + 2y + ax + ay", options: ["2(x + y) + a(x + y)", "(2 + a)(x + y)", "2a(x + y)", "(2 + x)(a + y)"], correctAnswerIndex: 1 },
                { question: "因式分解 h<sup>2</sup>k - h<sup>2</sup> - k + 1", options: ["(h<sup>2</sup> - 1)(k - 1)", "h<sup>2</sup>(k - 1) + (k - 1)", "(h - 1)(h + 1)(k - 1)", "(h<sup>2</sup> + 1)(k - 1)"], correctAnswerIndex: 0 },
                // 21-25 (Mixed Simple)
                { question: "因式分解 3a<sup>2</sup> - 27", options: ["3(a - 3)<sup>2</sup>", "3(a + 3)<sup>2</sup>", "3(a - 3)(a + 3)", "3(a - 9)(a + 3)"], correctAnswerIndex: 2 },
                { question: "因式分解 2x<sup>2</sup> + 8x + 8", options: ["2(x + 2)<sup>2</sup>", "2(x + 4)<sup>2</sup>", "2(x + 2)(x - 2)", "(2x + 4)<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "因式分解 5p<sup>2</sup> - 5", options: ["5(p - 1)<sup>2</sup>", "5(p - 1)(p + 1)", "5p(p - 1)", "5(p<sup>2</sup> - 1)"], correctAnswerIndex: 1 },
                { question: "因式分解 x<sup>2</sup> - y<sup>2</sup> + 2x - 2y", options: ["(x - y)(x + y + 2)", "(x + y)(x - y + 2)", "(x - y)(x - y + 2)", "(x - y)(x + y - 2)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>3</sup> - a", options: ["a(a<sup>2</sup> - 1)", "a(a - 1)(a + 1)", "a(a - 1)<sup>2</sup>", "a(a + 1)<sup>2</sup>"], correctAnswerIndex: 1 },
            ],
            '中級': [
                // 1-10 (Cross-method x^2+bx+c)
                { question: "因式分解 x<sup>2</sup> + 7x + 10", options: ["(x + 2)(x + 5)", "(x + 1)(x + 10)", "(x - 2)(x - 5)", "(x + 7)(x + 10)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>2</sup> - 5a + 6", options: ["(a - 2)(a - 3)", "(a + 2)(a + 3)", "(a - 6)(a + 1)", "(a - 6)(a - 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 y<sup>2</sup> - 2y - 8", options: ["(y - 2)(y + 4)", "(y + 2)(y - 4)", "(y - 8)(y + 1)", "(y - 2)(y - 4)"], correctAnswerIndex: 1 },
                { question: "因式分解 k<sup>2</sup> + k - 12", options: ["(k + 3)(k - 4)", "(k - 3)(k + 4)", "(k + 6)(k - 2)", "(k - 6)(k + 2)"], correctAnswerIndex: 1 },
                { question: "因式分解 m<sup>2</sup> + 7mn + 10n<sup>2</sup>", options: ["(m + 2n)(m + 5n)", "(m + n)(m + 10n)", "(m - 2n)(m - 5n)", "(m + 2n)(m - 5n)"], correctAnswerIndex: 0 },
                { question: "因式分解 p<sup>2</sup> - 5pq + 6q<sup>2</sup>", options: ["(p - 2q)(p + 3q)", "(p + 2q)(p + 3q)", "(p - 2q)(p - 3q)", "(p - 6q)(p + q)"], correctAnswerIndex: 2 },
                { question: "因式分解 x<sup>2</sup> + 2xy - 8y<sup>2</sup>", options: ["(x + 4y)(x - 2y)", "(x - 4y)(x + 2y)", "(x - 8y)(x + y)", "(x + 8y)(x - y)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>2</sup> - ab - 12b<sup>2</sup>", options: ["(a - 3b)(a + 4b)", "(a + 3b)(a + 4b)", "(a - 6b)(a + 2b)", "(a + 3b)(a - 4b)"], correctAnswerIndex: 3 },
                { question: "因式分解 3x<sup>2</sup> + 15x + 18", options: ["3(x + 2)(x + 3)", "3(x + 6)(x + 1)", "(3x + 6)(x + 3)", "3(x - 2)(x - 3)"], correctAnswerIndex: 0 },
                { question: "因式分解 2y<sup>2</sup> - 4y - 16", options: ["2(y + 2)(y - 4)", "2(y - 2)(y + 4)", "(2y - 4)(y + 4)", "2(y - 8)(y + 1)"], correctAnswerIndex: 0 },
                // 11-20 (Cross-method ax^2+bx+c)
                { question: "因式分解 2x<sup>2</sup> + 5x + 3", options: ["(2x + 3)(x + 1)", "(2x + 1)(x + 3)", "(2x + 5)(x + 1)", "(2x - 3)(x - 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 3a<sup>2</sup> - 7a + 2", options: ["(3a - 1)(a - 2)", "(3a + 1)(a + 2)", "(3a - 2)(a - 1)", "(3a - 7)(a - 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 5y<sup>2</sup> + 8y - 4", options: ["(5y + 2)(y - 2)", "(5y - 2)(y + 2)", "(5y - 4)(y + 1)", "(5y + 4)(y - 1)"], correctAnswerIndex: 1 },
                { question: "因式分解 6k<sup>2</sup> - k - 2", options: ["(3k - 2)(2k + 1)", "(3k + 2)(2k - 1)", "(6k - 1)(k + 2)", "(6k + 2)(k - 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 4m<sup>2</sup> + 11m - 3", options: ["(4m + 1)(m - 3)", "(4m - 1)(m + 3)", "(2m - 1)(2m + 3)", "(4m + 3)(m - 1)"], correctAnswerIndex: 1 },
                { question: "因式分解 2p<sup>2</sup> - 3pq - 2q<sup>2</sup>", options: ["(2p + 1q)(p - 2q)", "(2p - 1q)(p + 2q)", "(2p + q)(p - 2q)", "(2p - q)(p - 2q)"], correctAnswerIndex: 2 },
                { question: "因式分解 5x<sup>2</sup> + 7xy - 6y<sup>2</sup>", options: ["(5x - 3y)(x + 2y)", "(5x + 3y)(x - 2y)", "(5x - 6y)(x + y)", "(5x + 2y)(x - 3y)"], correctAnswerIndex: 0 },
                { question: "因式分解 10a<sup>2</sup> - 19a + 6", options: ["(5a - 2)(2a - 3)", "(5a + 2)(2a + 3)", "(10a - 3)(a - 2)", "(10a - 1)(a - 6)"], correctAnswerIndex: 0 },
                { question: "因式分解 8x<sup>2</sup> + 2xy - 15y<sup>2</sup>", options: ["(4x + 3y)(2x - 5y)", "(4x - 5y)(2x + 3y)", "(8x - 15y)(x + y)", "(4x - 3y)(2x + 5y)"], correctAnswerIndex: 1 },
                { question: "因式分解 6 - 5a - a<sup>2</sup>", options: ["(6 + a)(1 - a)", "(6 - a)(1 + a)", "(3 - a)(2 + a)", "(3 + a)(2 - a)"], correctAnswerIndex: 0 },
                // 21-25 (Simple (a)/(b) type)
                { question: "(a) 因式分解 x<sup>2</sup> - 9。<br>(b) 由此，因式分解 x<sup>2</sup> - 9 + xy - 3y。", options: ["(x - 3)(x + 3 + y)", "(x + 3)(x - 3 + y)", "(x - 3)(x - 3 + y)", "(x + 3)(x + 3 + y)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 a<sup>2</sup> + 4a + 4。<br>(b) 由此，因式分解 a<sup>2</sup> + 4a + 4 - b<sup>2</sup>。", options: ["(a + 2 - b)(a + 2 + b)", "(a + 2 - b)<sup>2</sup>", "(a - 2 - b)(a - 2 + b)", "(a + 2 + b)<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 4m - 8n。<br>(b) 由此，因式分解 4m - 8n + m<sup>2</sup> - 2mn。", options: ["(m - 2n)(4 + m)", "(m + 2n)(4 + m)", "(m - 2n)(4 - m)", "4(m - 2n) + m(m - 2n)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 p<sup>2</sup> - 5p + 6。<br>(b) 由此，因式分解 (k + 1)<sup>2</sup> - 5(k + 1) + 6。", options: ["(k - 1)(k - 2)", "(k + 3)(k - 2)", "(k - 1)(k + 2)", "(k - 3)(k - 2)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 x<sup>2</sup> + 7xy + 10y<sup>2</sup>。<br>(b) 由此，因式分解 x<sup>2</sup> + 7xy + 10y<sup>2</sup> - 4x - 8y。", options: ["(x + 2y)(x + 5y - 4)", "(x + 5y)(x + 2y - 4)", "(x + 2y - 4)(x + 5y - 4)", "(x - 2y)(x - 5y - 4)"], correctAnswerIndex: 1 },
            ],
            '高級': [
                // 1-10 (Complex (a)/(b) type from user file)
                { question: "(a) 因式分解 9m<sup>2</sup> - 25n<sup>2</sup>。<br>(b) 由此，因式分解 9m<sup>2</sup> - 25n<sup>2</sup> + 15m - 25n。", options: ["(3m - 5n)(3m + 5n + 5)", "(3m + 5n)(3m - 5n + 5)", "(3m - 5n)(3m - 5n + 5)", "(3m - 5n)(3m + 5n - 5)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 a<sup>2</sup> + 6ab + b<sup>2</sup>。<br>(b) 由此，因式分解 9a<sup>2</sup> + 6ab + b<sup>2</sup> - 6a - 2b。", options: ["(3a + b)(3a + b - 2)", "(3a + b)(3a + b + 2)", "(3a - b)(3a - b - 2)", "(3a + b)<sup>2</sup> - 2(3a + b)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 a<sup>2</sup> - 5ab + 6b<sup>2</sup>。<br>(b) 由此，因式分解 a<sup>2</sup> - 5ab + 6b<sup>2</sup> + 3a - 9b。", options: ["(a - 3b)(a - 2b + 3)", "(a - 2b)(a - 3b + 3)", "(a - 3b)(a - 2b - 3)", "(a - 3b)(a + 2b + 3)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 x<sup>2</sup> - 2x - 8。<br>(b) 由此，因式分解 x<sup>2</sup> - 2x - 8 - xy<sup>2</sup> + 4y<sup>2</sup>。", options: ["(x - 4)(x + 2 - y<sup>2</sup>)", "(x + 2)(x - 4 - y<sup>2</sup>)", "(x - 4)(x + 2 + y<sup>2</sup>)", "(x - 4)(x - 2 - y<sup>2</sup>)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 16a<sup>3</sup> - 32a<sup>2</sup>b。<br>(b) 由此，因式分解 16a<sup>3</sup> - 32a<sup>2</sup>b - ab<sup>2</sup> + 2b<sup>3</sup>。", options: ["(a - 2b)(4a - b)(4a + b)", "(a - 2b)(16a<sup>2</sup> + b<sup>2</sup>)", "(a + 2b)(4a - b)(4a + b)", "(a - 2b)(16a<sup>2</sup> - b<sup>2</sup>)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 4x<sup>2</sup> + 36x + 81。<br>(b) 由此，因式分解 (3x - 5y)<sup>2</sup> - (4x<sup>2</sup> + 36x + 81)。", options: ["(x - 5y - 9)(5x - 5y + 9)", "(x + 5y + 9)(5x - 5y - 9)", "(x - 5y - 9)(-x - 5y + 9)", "(x - 5y - 9)(x - 5y + 9)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 x<sup>2</sup> + 2xy - 8y<sup>2</sup>。<br>(b) 由此，因式分解 x<sup>2</sup> + 2xy - 8y<sup>2</sup> - 2x - 8y。", options: ["(x + 4y)(x - 2y - 2)", "(x - 2y)(x + 4y - 2)", "(x + 4y)(x - 2y + 2)", "(x - 4y)(x + 2y - 2)"], correctAnswerIndex: 0 },
                { question: "(a) 因式分解 2m<sup>2</sup> - 3mn - 2n<sup>2</sup>。<br>(b) 由此，因式分解 2m<sup>2</sup> - 3mn - 2n<sup>2</sup> - 4m + 8n。", options: ["(m - 2n)(2m + n - 4)", "(m + 2n)(2m - n - 4)", "(m - 2n)(2m - n - 4)", "(m - 2n)(2m + n + 4)"], correctAnswerIndex: 0 },
                { question: "因式分解 x<sup>3</sup> - x<sup>2</sup>y + 3x<sup>2</sup> - 2x + 2y - 6", options: ["(x - y + 3)(x<sup>2</sup> - 2)", "(x - y - 3)(x<sup>2</sup> - 2)", "(x - y + 3)(x<sup>2</sup> + 2)", "(x + y + 3)(x<sup>2</sup> - 2)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>3</sup> - 5a<sup>2</sup>b - 5a<sup>2</sup> + a - 5b - 5", options: ["(a - 5b - 5)(a - 1)(a + 1)", "(a - 5b - 5)(a<sup>2</sup> + 1)", "(a + 5b + 5)(a - 1)(a + 1)", "(a - 5b + 5)(a - 1)(a + 1)"], correctAnswerIndex: 0 },
                // 11-15 (Sum/Difference of Cubes)
                { question: "因式分解 x<sup>3</sup> + 8", options: ["(x + 2)(x<sup>2</sup> - 2x + 4)", "(x + 2)(x<sup>2</sup> + 2x + 4)", "(x + 2)<sup>3</sup>", "(x - 2)(x<sup>2</sup> + 2x + 4)"], correctAnswerIndex: 0 },
                { question: "因式分解 y<sup>3</sup> - 27", options: ["(y - 3)(y<sup>2</sup> - 3y + 9)", "(y - 3)(y<sup>2</sup> + 3y + 9)", "(y - 3)<sup>3</sup>", "(y + 3)(y<sup>2</sup> - 3y + 9)"], correctAnswerIndex: 1 },
                { question: "因式分解 64a<sup>3</sup> + 1", options: ["(4a + 1)(16a<sup>2</sup> - 4a + 1)", "(4a + 1)(16a<sup>2</sup> + 4a + 1)", "(4a + 1)<sup>3</sup>", "(4a - 1)(16a<sup>2</sup> + 4a + 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 8p<sup>3</sup> - 125q<sup>3</sup>", options: ["(2p - 5q)(4p<sup>2</sup> + 10pq + 25q<sup>2</sup>)", "(2p - 5q)(4p<sup>2</sup> - 10pq + 25q<sup>2</sup>)", "(2p - 5q)<sup>3</sup>", "(2p + 5q)(4p<sup>2</sup> - 10pq + 25q<sup>2</sup>)"], correctAnswerIndex: 0 },
                { question: "因式分解 m<sup>3</sup> + 216n<sup>3</sup>", options: ["(m + 6n)(m<sup>2</sup> + 6mn + 36n<sup>2</sup>)", "(m + 6n)<sup>3</sup>", "(m + 6n)(m<sup>2</sup> - 6mn + 36n<sup>2</sup>)", "(m - 6n)(m<sup>2</sup> + 6mn + 36n<sup>2</sup>)"], correctAnswerIndex: 2 },
                // 16-20 (Complex Difference of Squares)
                { question: "因式分解 (a + b)<sup>2</sup> - (a - b)<sup>2</sup>", options: ["2a<sup>2</sup> + 2b<sup>2</sup>", "4ab", "2b<sup>2</sup>", "4a<sup>2</sup>b<sup>2</sup>"], correctAnswerIndex: 1 },
                { question: "因式分解 (2x + 1)<sup>2</sup> - (x - 3)<sup>2</sup>", options: ["(x + 4)(3x - 2)", "(x - 4)(3x + 2)", "(x + 4)(3x + 2)", "(3x - 2)(x - 2)"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>4</sup> - 16", options: ["(a<sup>2</sup> - 4)(a<sup>2</sup> + 4)", "(a - 2)(a + 2)(a<sup>2</sup> + 4)", "(a - 2)<sup>2</sup>(a + 2)<sup>2</sup>", "(a - 2)<sup>4</sup>"], correctAnswerIndex: 1 },
                { question: "因式分解 1 - (p - q)<sup>2</sup>", options: ["(1 - p + q)(1 + p - q)", "(1 - p - q)(1 + p - q)", "(1 - p + q)(1 - p - q)", "(p - q - 1)(p - q + 1)"], correctAnswerIndex: 0 },
                { question: "因式分解 9(x + y)<sup>2</sup> - 4(x - y)<sup>2</sup>", options: ["(x + 5y)(5x + y)", "(x - 5y)(5x - y)", "(x + 5y)<sup>2</sup>", "(x + 5y)(5x - y)"], correctAnswerIndex: 0 },
                // 21-25 (Mixed Complex)
                { question: "因式分解 x<sup>2</sup> - 4y<sup>2</sup> - 6x + 9", options: ["(x - 3 - 2y)(x - 3 + 2y)", "(x + 3 - 2y)(x + 3 + 2y)", "(x - 3 - 2y)<sup>2</sup>", "(x - 3)<sup>2</sup> - (2y)<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "因式分解 a<sup>2</sup> + 2ab + b<sup>2</sup> - 10a - 10b + 25", options: ["(a + b - 5)<sup>2</sup>", "(a + b + 5)<sup>2</sup>", "(a + b - 5)(a + b + 5)", "(a + b - 10)<sup>2</sup> + 25"], correctAnswerIndex: 0 },
                { question: "因式分解 p<sup>2</sup> - q<sup>2</sup> + 2pr + r<sup>2</sup>", options: ["(p + r - q)(p + r + q)", "(p - r - q)(p - r + q)", "(p + r)<sup>2</sup> - q<sup>2</sup>", "(p - q + r)<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "因式分解 4x<sup>2</sup> - y<sup>2</sup> - 4x + 1", options: ["(2x - 1 - y)(2x - 1 + y)", "(2x + 1 - y)(2x + 1 + y)", "(2x - 1 - y)<sup>2</sup>", "(2x - 1)<sup>2</sup> - y<sup>2</sup>"], correctAnswerIndex: 0 },
                { question: "因式分解 m<sup>3</sup> - m<sup>2</sup> - m + 1", options: ["(m - 1)<sup>2</sup>(m + 1)", "(m - 1)(m + 1)<sup>2</sup>", "(m - 1)<sup>3</sup>", "m<sup>2</sup>(m - 1) - (m - 1)"], correctAnswerIndex: 0 },
            ]
        };

        // 總題庫
        const allQuestionBanks = {
            '指數': indicesQuestionBank,
            '因式分解': factorizationQuestionBank
        };

        // --- 應用程式狀態 ---
        let currentTopic = '';
        let currentBank = null; // 將儲存所選主題的題庫
        let currentDifficulty = '初級';
        let sessionQuestions = [];
        let currentQuestionIndex = 0;
        let sessionScore = 0;

        // --- DOM 元素參照 ---
        const topicScreen = document.getElementById('topic-screen'); // 新
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const summaryScreen = document.getElementById('summary-screen');

        const selectTopicIndicesBtn = document.getElementById('select-topic-indices'); // 新
        const selectTopicFactorizationBtn = document.getElementById('select-topic-factorization'); // 新
        const backToTopicSelectBtn = document.getElementById('back-to-topic-select'); // 新
        const quizChangeTopicBtn = document.getElementById('quiz-change-topic-btn'); // 新
        const summaryChangeTopicBtn = document.getElementById('summary-change-topic-btn'); // 新

        const startButton = document.getElementById('start-button');
        const nextButton = document.getElementById('next-button');
        const nextSessionButton = document.getElementById('next-session-button');

        const appTitle = document.getElementById('app-title'); // 新
        const appSubtitle = document.getElementById('app-subtitle'); // 新
        const difficultyDisplay = document.getElementById('difficulty-display');
        const startDifficultyLabel = document.getElementById('start-difficulty-label');

        const questionCounter = document.getElementById('question-counter');
        const currentScore = document.getElementById('current-score');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        const feedbackContainer = document.getElementById('feedback-container');
        const correctAnswerText = document.getElementById('correct-answer-text');
        const answerStatus = document.getElementById('answer-status'); 
        
        const summaryText = document.getElementById('summary-text');
        const assessmentText = document.getElementById('assessment-text');
        const assessmentFeedback = document.getElementById('assessment-feedback');


        // --- 事件監聽 ---
        selectTopicIndicesBtn.addEventListener('click', () => selectTopic('指數'));
        selectTopicFactorizationBtn.addEventListener('click', () => selectTopic('因式分解'));
        
        backToTopicSelectBtn.addEventListener('click', showTopicScreen);
        quizChangeTopicBtn.addEventListener('click', showTopicScreen);
        summaryChangeTopicBtn.addEventListener('click', showTopicScreen);

        startButton.addEventListener('click', startSession);
        nextButton.addEventListener('click', loadNextQuestion);
        nextSessionButton.addEventListener('click', startSession); // 點擊 "下一輪" 會使用相同的 'currentTopic' 和更新後的 'currentDifficulty'
        optionsContainer.addEventListener('click', handleAnswer);

        // --- 核心函式 ---

        /**
         * 0. 顯示主題選擇畫面 (新的進入點)
         */
        function showTopicScreen() {
            // 重設狀態
            currentTopic = '';
            currentBank = null;
            currentDifficulty = '初級'; // 每次返回都重設難度

            // 更新 UI
            appTitle.textContent = '數學適性學習';
            appSubtitle.textContent = '請選擇一個練習主題';
            difficultyDisplay.classList.add('hidden');

            // 切換畫面
            startScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            summaryScreen.classList.add('hidden');
            topicScreen.classList.remove('hidden');
        }

        /**
         * 1. 選擇主題
         */
        function selectTopic(topicName) {
            currentTopic = topicName;
            currentBank = allQuestionBanks[topicName];
            currentDifficulty = '初級'; // 選擇新主題時，從初級開始

            // 更新 UI
            appTitle.textContent = `主題：${currentTopic}`;
            appSubtitle.textContent = '準備開始練習';
            difficultyDisplay.textContent = `目前難度：${currentDifficulty}`;
            startDifficultyLabel.textContent = currentDifficulty;
            difficultyDisplay.classList.remove('hidden');

            // 切換畫面
            topicScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        }


        /**
         * Fisher-Yates (aka Knuth) Shuffle
         * 用於隨機打亂陣列
         */
        function shuffleArray(array) {
            let currentIndex = array.length,  randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        /**
         * 2. 開始新一輪測驗
         */
        function startSession() {
            // 重設狀態
            sessionScore = 0;
            currentQuestionIndex = 0;
            sessionQuestions = [];

            // 根據目前主題和難度獲取 5 道題目
            const availableQuestions = [...currentBank[currentDifficulty]];
            sessionQuestions = shuffleArray(availableQuestions).slice(0, 5);
            
            // 更新 UI
            difficultyDisplay.textContent = `目前難度：${currentDifficulty}`;
            currentScore.textContent = `目前得分：0`;

            // 切換畫面
            startScreen.classList.add('hidden');
            summaryScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            // D載入第一題
            displayQuestion();
        }

        /**
         * 3. 顯示目前題目
         */
        function displayQuestion() {
            // 獲取目前題目
            const question = sessionQuestions[currentQuestionIndex];
            
            // 更新題目文字 (使用 innerHTML 來渲染 <sup>)
            questionText.innerHTML = question.question;

            // 清空舊選項
            optionsContainer.innerHTML = '';

            // 生成新選項按鈕
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.classList.add('option-btn');
                button.dataset.index = index;
                button.innerHTML = option; // 使用 innerHTML
                optionsContainer.appendChild(button);
            });

            // 更新進度
            questionCounter.textContent = `題目 ${currentQuestionIndex + 1} / 5`;
            
            // 隱藏「下一題」按鈕
            nextButton.classList.add('hidden');
            // 隱藏反饋
            feedbackContainer.classList.add('hidden');
            correctAnswerText.innerHTML = '';
            answerStatus.classList.add('hidden'); 
            answerStatus.textContent = ''; 
        }

        /**
         * 4. 處理使用者作答
         */
        function handleAnswer(e) {
            const selectedButton = e.target.closest('.option-btn');
            if (!selectedButton || selectedButton.disabled) return; // 防止重複點擊

            const selectedAnswerIndex = parseInt(selectedButton.dataset.index);
            const question = sessionQuestions[currentQuestionIndex];
            const correctAnwserIndex = question.correctAnswerIndex;
            const correctAnswerString = question.options[correctAnwserIndex]; 

            // 停用所有選項按鈕
            Array.from(optionsContainer.children).forEach(button => {
                button.disabled = true;
                button.classList.remove('option-btn:hover'); 
            });

            // 檢查答案
            if (selectedAnswerIndex === correctAnwserIndex) {
                // 答對
                sessionScore++;
                selectedButton.classList.add('correct');
                answerStatus.textContent = '答對了！';
                answerStatus.className = 'mt-6 text-xl font-bold text-green-600';
                answerStatus.classList.remove('hidden');
            } else {
                // 答錯
                selectedButton.classList.add('wrong');
                const correctButton = optionsContainer.querySelector(`[data-index="${correctAnwserIndex}"]`);
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
                answerStatus.textContent = '答錯了';
                answerStatus.className = 'mt-6 text-xl font-bold text-red-600';
                answerStatus.classList.remove('hidden');
            }

            // 顯示正確答案文字框
            correctAnswerText.innerHTML = correctAnswerString;
            feedbackContainer.classList.remove('hidden');

            // 顯示「下一題」按鈕
            nextButton.classList.add('hidden');
            
            // 更新即時分數
            currentScore.textContent = `目前得分：${sessionScore}`;
        }

        /**
         * 5. 載入下一題或結束
         */
        function loadNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < 5) {
                // 還有題目，顯示下一題
                displayQuestion();
            } else {
                // 5 題結束，顯示總結
                showSummary();
            }
        }

        /**
         * 6. 顯示總結與評估
         */
        function showSummary() {
            // 切換畫面
            quizScreen.classList.add('hidden');
            summaryScreen.classList.remove('hidden');

            // 顯示總分
            summaryText.textContent = `您在 5 題中答對了 ${sessionScore} 題。`;

            // 難度調整邏輯
            let assessmentMsg = "";
            let newDifficulty = currentDifficulty; // 暫存新難度

            if (sessionScore <= 1) {
                // 0-1 題：保持初級 (或從中級降回初級)
                newDifficulty = '初級';
                assessmentMsg = "看來基礎還需要加強，我們將繼續停在【初級】練習。";
                assessmentFeedback.className = "mb-6 p-4 bg-red-50 border border-red-200 rounded-lg";
                assessmentText.className = "text-red-800 font-medium";
            } else if (sessionScore <= 3) {
                // 2-3 題：調整為中級
                newDifficulty = '中級';
                assessmentMsg = "表現不錯！我們準備好進入【中級】難度了。";
                assessmentFeedback.className = "mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg";
                assessmentText.className = "text-yellow-800 font-medium";
            } else {
                // 4-5 題：調整為高級
                newDifficulty = '高級';
                assessmentMsg = "太棒了！您已精通這個級別，準備挑戰【高級】難度吧！";
                assessmentFeedback.className = "mb-6 p-4 bg-green-50 border border-green-200 rounded-lg";
                assessmentText.className = "text-green-800 font-medium";
            }

            // 更新全域難度
            currentDifficulty = newDifficulty;

            // 更新評估文字和下一輪的難度提示
            assessmentText.textContent = assessmentMsg;
            nextSessionButton.textContent = `開始下一輪 (${currentDifficulty})`;
            
            // 同步更新開始畫面的難度提示
            difficultyDisplay.textContent = `目前難度：${currentDifficulty}`;
            startDifficultyLabel.textContent = currentDifficulty;
        }

        // --- 初始啟動 ---
        // 應用程式現在會自動顯示 topic-screen，等待使用者操作
        // showTopicScreen(); // 頁面載入時預設顯示主題選擇

    </script>
</body>
</html>
